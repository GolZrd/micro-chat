# Микросервисный чат с JWT авторизацией, role-based доступом и веб-интерфейсом

## 📋 Содержание
- [Возможности](#-возможности)
- [Архитектура](#-архитектура)
- [Технологии](#-технологии)
- [Roadmap](#-roadmap)
- [Быстрый старт](#-быстрый-старт)

## ✨ Возможности

### 🔐 Аутентификация и авторизация
- Регистрация пользователей с валидацией email и пароля
- Используются JWT токены (Access + Refresh)
- Вход (Login) с выдачей JWT токенов (Access + Refresh)
- Role-Based Access Control (Реализовано 2 роли: guest и user)
- Удаление пользователя с каскадным удалением данных
- Автоматическое обновление токенов 
- Безопасное хранение refresh tokens в HTTP-only cookies

### 💬 Функционал чата
- Создание групповых чатов (имена участников вводятся при создании)
- Real-time сообщения через WebSocket
- gRPC streaming для мгновенной доставки
- История сообщений (Реализован показ последних 50 сообщений)
- Просмотр списка своих чатов

### ⚡ Производительность
- Redis кэширование для проверок доступа (Access check - самая частая операция)
- gRPC для межсервисного взаимодействия
- Docker - Полная контейнеризация
- SQL запросы с индексами

### 📊 Observability
- Структурированное логирование (Zap)
- Prometheus метрики (в плане)
- Unit тесты с использованием minimock (покрытие тестами auth > 80%)

### Web-UI
- Веб интерфейс (всe static файлы) сгенерирован нейросетью, с моими правками
- Применялся веб-фреймворк Gin

### CI/CD 
- GitHub Actions автоматически собирает приложение и запускает тесты в микросервисах
- Применяется скрипт для создания баз данных при запуске


## 🏗 Архитектура

### Проект следует принципам **Clean Architecture** с разделением на слои:
┌─────────────────────────────────────────┐
│ API Layer (gRPC) │
├─────────────────────────────────────────┤
│ Service Layer │
│ (Бизнес-логика + DI контейнеры) │
├─────────────────────────────────────────┤
│ Repository Layer │
│ (Работа с PostgreSQL) │
└─────────────────────────────────────────┘
### Общая архитектура системы
         ┌──────────┐
         │ Browser  │
         └────┬─────┘
              │ HTTP/WebSocket
              ▼
     ┌─────────────────────┐
     │ Web Gateway         │ :8080
     │ (Gin + WebSocket)   │
     └──────┬──────────────┘
            │ gRPC
 ┌────────────────────────────┐
 ▼                            ▼
┌──────────────┐       ┌──────────────┐
│ Auth Service │:50051 │ Chat Service │:50052
│ - JWT        │       │ - Messages   │
│ - RBAC       │       │ - Streaming  │
│ - Users      │       │ - Chats      │
└──────┬───────┘       └──────┬───────┘
       │                      │
       ▼                      │
┌──────────────┐              │
│ Redis        │:6379         │
│ (L2 Cache)   │              │
└──────────────┘              │
       │                      │
       │PostgreSQL            │PostgreSQL
       ▼                      ▼
┌─────────────┐        ┌─────────────┐
│ auth_db     │        │ chat_db     │
└─────────────┘        └─────────────┘

## Технологии

### Backend
- **Go 1.24** - основной язык
- **gRPC** - межсервисное взаимодействие
- **Protocol Buffers** - сериализация данных
- **Gin** - HTTP framework для gateway
- **Gorilla WebSocket** - real-time коммуникация

### Databases & Cache
- **PostgreSQL** - основная БД
- **pgx** - драйвер для работы с PostgreSQL 
- **Redis** - кэширование 

### Безопасность
- **JWT** - токены доступа (RS256/HS256)
- **Bcrypt** - хеширование паролей (В плане)

### DevOps
- **Docker & Docker Compose** - контейнеризация
- **Migrate** - миграции БД

### Observability
- **Zap** - структурированное логирование

## 📝 Roadmap
- [ ] Настроить отображение чатов на главной странице
- [ ] Добавить проверку существования пользователя при создании чата
- [ ] Добавить корректную обработку ошибок в web-gateway
- [ ] Добавить метрики (Prometheus)
- [ ] Дашборд (Grafana)
- [ ] Добавить Tracing (Jaeger)
- [ ] Добавить хэширование пароля (для наглядности сейчас без хэширования)
- [ ] Добавить транзакции БД
- [ ] Покрыть тестами chat-server

## 🛠 Запуск

### Быстрый старт
```bash
git clone https://github.com/GolZrd/micro-chat.git # Клонируйте репозиторий
cd micro-chat
```
```bash
docker-compose up -d # Запуск всех сервисов
```